---
- hosts: all
  tasks:
    - name: Install VIM
      apt:
        name: vim
        state: present
    
    - name: Install Git
      apt:
        name: git
        state: present
        
    - name: Install dos2unix
      apt:
        name: dos2unix
        state: present
        
    - name: Install software-properties-common
      apt:
        name: software-properties-common
        state: present
        
    - name: Install Python 3
      apt: 
        name: python3
        state: present
       
    - name: Check if Spotify Installed
      stat:
        path: /etc/apt/sources.list.d/spotify.list
      register: spotify_result
        
    - name: Add Spotify Public Key
      raw: curl -sS https://download.spotify.com/debian/pubkey_0D811D58.gpg | apt-key add -      
      when: not spotify_result.stat.exists

    - name: Add Spotify as apt source
      raw: echo "deb http://repository.spotify.com stable non-free" | tee /etc/apt/sources.list.d/spotify.list
      when: not spotify_result.stat.exists
      
    - name: Apt Update
      raw: apt update -y || true
      when: not spotify_result.stat.exists
    
    - name: Install Spotify
      apt:
        name: spotify-client
        state: present

